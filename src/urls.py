import redis


PROXY_USER = 'odcpm'
PROXY_PASSWORD = 'ondeck1556'
PROXIES = ["176.61.143.129", "23.19.35.213", "174.140.171.226", "173.213.108.219", "108.62.71.46", "74.221.211.142", "173.212.192.227", "173.213.108.67", "173.213.108.224", "173.198.253.205", "173.208.171.164", "108.62.71.193", "173.213.108.208", "176.61.140.135", "74.221.212.142", "173.213.108.212", "173.212.192.134", "176.61.140.131", "173.212.192.228", "173.213.108.210", "173.213.108.218", "142.91.16.250", "108.62.71.47", "176.61.140.139", "142.91.16.34", "64.31.9.3", "74.221.215.166", "173.208.171.135", "173.234.33.29", "142.91.16.140", "176.61.140.132", "108.62.71.162", "173.212.192.231", "74.221.211.137", "108.62.71.67", "173.213.108.166", "74.221.212.126", "173.212.192.133", "142.91.16.181", "173.213.108.211", "173.213.108.167", "174.122.237.100", "176.61.140.109", "74.221.211.140", "173.212.192.132", "176.61.140.136", "173.212.192.221", "173.213.108.213", "173.213.108.201", "173.212.192.143", "173.213.108.63", "142.91.16.243", "108.62.71.14", "173.212.192.135", "142.91.16.252", "173.208.171.134", "176.61.140.134", "173.208.171.130", "142.91.16.3", "50.115.163.160", "173.213.108.222", "173.198.253.206", "142.91.16.44", "173.213.108.68", "173.212.192.230", "108.62.71.133", "74.221.211.128", "173.213.108.221", "173.212.192.139", "142.91.16.167", "108.62.71.182", "173.213.108.202", "173.213.108.2", "173.212.192.150", "173.198.253.204", "38.65.34.119", "173.213.108.215", "173.213.108.168", "176.61.140.111", "173.213.108.209", "174.122.237.112", "173.213.108.65", "142.91.16.106", "74.221.212.230", "173.208.171.136", "176.61.140.130", "174.140.171.76", "176.61.143.114", "108.62.71.215", "173.213.108.217", "108.62.71.254", "173.198.253.202", "173.208.171.132", "38.65.34.117", "74.221.211.131", "173.213.108.200", "173.0.51.166", "173.213.108.21", "173.213.108.207"]


def round_robin(list):
    while True:
        for item in list:
            yield(item)

def generate_urls_from_file(urlsFile):
    proxies = round_robin(PROXIES)
    for line in open(urlsFile):
        proxy = 'http://%(username)s:%(pass)s@%(ip)s:%(port)d/' % \
            {'username': PROXY_USER, 'pass': PROXY_PASSWORD, 
                'ip': proxies.next(), 'port': 55555}
        yield (line.strip('\n'), proxy)
    raise StopIteration()

def generate_urls_from_db():
    proxies = round_robin(PROXIES)
    red = redis.StrictRedis()
    while red.srandmember('urls_to_crawl'):
        proxy = 'http://%(username)s:%(pass)s@%(ip)s:%(port)d/' % \
            {'username': PROXY_USER, 'pass': PROXY_PASSWORD, 
                'ip': proxies.next(), 'port': 55555}
        #grab the next url
        nextUrl = red.spop('urls_to_crawl')
        yield (nextUrl, proxy)
    raise StopIteration()

